<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>How's the River?</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
	<meta name="viewport" content="width=device-width"/>
	  <script src="javascripts/jquery-1.12.4.min.js"></script>
	  <script>
		$(document).ready(function () {
		 $.getJSON('https://s3-us-west-2.amazonaws.com/howsthewater/data.json', function (data) {
			 var temperature_fahrenheit;
			 var ecoli_count;
			 
			 for (var key in data) {
				
				if (key == "ecoli") {
					// These thresholds are based on the values given by the WHO for 'Very Good', 'Good', 'Poor' and 'Very Poor' 
					// water quality for swimming. The very poor value was lowered from 500 (given by the WHO) 
					// to 406 (the maximum allowed value for safe swimming according to Oregon DEQ).
					// Sources: http://www.who.int/water_sanitation_health/bathing/srwe1-chap4.pdf
					// 			http://www.portlandoregon.gov/bes/article/390127
					ecoli_count = data[key];
				} else if (key == "ecoli_date") {
					//
				} else if (key == "temperature_celcius") {					
					temperature_fahrenheit = (data[key] * 1.8 + 32).toFixed(0);
				} else if (key == "temperature_date") {
					//
				}
			  };
			
			var temperature_text = ""
			var emoji_image_src = ""
			if (temperature_fahrenheit < 55) { // nope nope nope
				temperature_text = "freezing";
				emoji_image_src = "images/face4.png";
			} else if (temperature_fahrenheit < 61) { // brrr
				temperature_text = "cold";				
				emoji_image_src = "images/face3.png";
			} else if (temperature_fahrenheit < 72 ) { // cool
				temperature_text = "cool";				
				emoji_image_src = "images/face2.png";
			} else { // warm!
				temperature_text = "warm";
				emoji_image_src = "images/face1.png"
			}
			
			var quality_element = $( ".quality" );
			if (ecoli_count < 41) {
				quality_element.append( "very clean" );
				$('body').css({"background-color": '#43a4ea'});						
			} else if (ecoli_count <200 ) {
				quality_element.append( "clean" );
				$('body').css({"background-color": '#2ECE9A'});						
			} else if (ecoli_count <406 ) {
				emoji_image_src = "images/face3.png"				
				quality_element.append( "swimmable" );
				$('body').css({"background-color": '#A4CE2E'});						
			} else {
				emoji_image_src = "images/face4.png"
				quality_element.append( "not clean" );
				$('body').css({"background-color": '#cc0909'});												
			}
			
			
			$( ".emoji" ).attr("src", emoji_image_src);
			$(".temperature").append(temperature_fahrenheit + "â„‰");
			$(".temperature_text").append(temperature_text);
		  });
	  });
	</script>
  </head>
  <body>
    <div class="wrapper">
      <span class="header-wrapper">
      <header>
		<img class="emoji" style="margin: auto; display: block;"></img>
		<div style="text-align: center;"> <span class="temperature" style="font-size: 48pt;"></span></div>
		<div class="title" style="font-size: 24pt; text-align: center;">The Willamette is <br/><span class="temperature_text"></span> and <span class="quality"></span>!</div>
      </header>
	  </span>
      <span class="footer-wrapper">
      <footer>
		<span style="float:left; text-align: center;">
		<a href="https://donate.humanaccessproject.com">
  		<img class="hap_logo" src="images/HAP_logo.png"/></a><br/>
		<a href="https://donate.humanaccessproject.com">Help Create<br/></a>
		River Access
		</span>
		<div class="footer_text">
			<p>Isn't the Willamette kinda gnarly? <a href="http://www.humanaccessproject.com/about/willamette_river_water_quality">Nope.</a></p>
        	<p>This site was created by <a href="https://twitter.com/evanheidtmann">@evanheidtmann</a> and <a href="https://twitter.com/quicklywilliam">@quicklywilliam</a>. Read the Code on <a href="https://github.com/KnockSoftware/willamette">GitHub</a>.</p>
			 <p>Data gathered from <a href="https://www.portlandoregon.gov/bes/waterquality/results.cfm">BES</a> and <a href="http://or.water.usgs.gov/will_morrison/monitors/will_morrison_t_7.html">USGS</a>.</p>
		 </div>
    </footer>
	</span>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
